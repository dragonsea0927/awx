---
- name: Run Integration Test
  hosts: localhost
  connection: local
  gather_facts: False
  environment:
      TOWER_HOST: https://ansible-tower-web-svc-tower.apps-crc.testing
      TOWER_USERNAME: admin
      TOWER_PASSWORD: password
      TOWER_VERIFY_SSL: False
  collections:
    - awx.awx

  tasks:
    - name: Update a git project, update the project and wait.
      tower_project:
        name: abcd
        organization: Default
        scm_type: git
        scm_branch: empty_branch
        scm_url: https://github.com/ansible/test-playbooks
        allow_override: true
        wait: true
        update_project: true
      register: result

    - name: Sleep for 300 seconds and continue with play
      wait_for:
        timeout: 15

    - name: Update a git project, update the project without waiting.
      tower_project:
        name: abcd
        organization: Default
        scm_type: git
        scm_branch: empty_branch
        scm_url: https://github.com/ansible/test-playbooks
        wait: false
        update_project: true
      register: result